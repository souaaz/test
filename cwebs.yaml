swagger: '2.0'
info:
  title: CWEBS API
  version: "0.1"
consumes:
  - application/json
produces:
  - application/json
security:
  # enable OAuth protection for all REST endpoints
  # (only active if the TOKENINFO_URL environment variable is set)
  - oauth2: [uid]
paths:
  /cwebs/version/:
    get:
      tags: [CWEBS]
      operationId: app.get_version
      summary: Get Version
      
      responses:
        200:
          description: Return version
          schema:
            type: string
           
  /all_fares/:
    get:
      tags: ["tests"]
      summary: Gets all fares
      operationId: app.get_all_fares

      description: Returns a list containing all fares.
      responses:
        200:
          description: A list of Fare
          schema:
            type: array
            items:
              required:
                - username
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                username:
                  type: string

  /fares/read_book_order/:
    post:
      tags: [CWEBS]      
      summary: Get 1 fare
      operationId: app.get_fare
      description: read 1 fare
      parameters:
        - name: fare_number
          in: body
          description: fare fare_number
          schema:
            required:             
              - fare_number
            properties:
              fare_type:
                type: string
              fare_number:
                type: string
      responses:
        200:
          description: A list of Fare
          schema:
            type: array
            items:
              required:
                - username
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                username:
                  type: string
        400:
          description: Fare does not exist


  /dispatcher/save_book_order/:
    post:
      tags: [CWEBS]      
      summary: Creates a fare
      operationId: app.create_fare
      description: Adds a new fare
      parameters:
        - name: fare
          in: body
          description: Adds a new fare.
          schema:
            $ref: "#/definitions/FareCreation"
      responses:
        200:
          description: Return fare created
          schema:
            $ref: '#/definitions/FareCreated'              
        400:
          description: Fare could not be created.

  /dispatcher/modify_book_order/:
    post:
      tags: [CWEBS]      
      summary: Modifies a fare
      operationId: app.modify_fare
      description: Modifies a fare
      parameters:
        - name: fare
          in: body
          description:  Modifies a fare
          schema:
            $ref: "#/definitions/FareModification"
      responses:
        200:
          description: Return fare 
          schema:
            $ref: '#/definitions/FareCreated'              
        400:
          description: Fare could not be modified.

  /dispatcher/cancel_book_order/:
    post:
      tags: [CWEBS]      
      summary: Cancels a fare
      operationId: app.cancel_fare
      description: Cancels a new fare
      parameters:
        - name: fare
          in: body
          description: Cancels a fare.
          schema:
            $ref: "#/definitions/FareCancelation"
      responses:
        200:
          description: Return fare cancel
          schema:
            $ref: '#/definitions/FareCanceled'              
        400:
          description: Fare could not be canceled.


  /message/send_driver_msg/:
    post:
      tags: [CWEBS]      
      summary: Message to driver 
      operationId: app.send_driver_msg
      description: Message to driver 
      parameters:
        - name: driver_msg
          in: body
          description: Adds a new mesg
          schema:
            $ref: "#/definitions/DriverMsg"
      responses:
        200:
          description: Message to driver succesfully sent.
        400:
          description: Message could not be sent.


  /message/send_vehicle_msg/:
    post:
      tags: [CWEBS]      
      summary: Message to vehicle 
      operationId: app.send_vehicle_msg
      description: Message to vehicle
      parameters:
        - name: vehicle_msg
          in: body
          description: Adds a new mesg
          schema:
            $ref: "#/definitions/VehicleMsg"
      responses:
        200:
          description: Message to vehicle succesfully sent.
        400:
          description: Message could not be sent.

  /message/send_fleet_msg/:
    post:
      tags: [CWEBS]      
      summary: Message to fleet 
      operationId: app.send_fleet_msg
      description: Message to fleet
      parameters:
        - name: fleet_msg
          in: body
          description: Adds a new mesg
          schema:
            $ref: "#/definitions/FleetMsg"
      responses:
        200:
          description: Message to fleet succesfully sent.
        400:
          description: Message could not be sent.

  /dispatcher/update_fare/:
    post:
      tags: [CWEBS]      
      summary: Update fare
      operationId: app.update_fare
      description: update fare
      parameters:
        - name: fare
          in: body
          description: Update Fare Status
          schema:
            $ref: "#/definitions/UpdateFare"
      responses:
        200:
          description: success
        400:
          description: Update did not succeed.

  /driver/action/:
    post:
      tags: [CWEBS]      
      summary: Update, Add, Delete a driver 
      operationId: app.driver_action
      description: Update, Add a driver
      parameters:
        - name: action_params
          in: body
          description: driver params
          schema:
            $ref: "#/definitions/ActionDriverData"
      responses:
        200:
          description: success
        400:
          description: Error 

  /fleet/action/:
    post:
      tags: [CWEBS]      
      summary: Update, Add, Delete a fleet
      operationId: app.fleet_action
      description: Update, Add a fleet
      parameters:
        - name: action_params
          in: body
          description: fleet params
          schema:
            $ref: "#/definitions/ActionFleetData"
      responses:
        200:
          description: success
        400:
          description: Error 

  /supervisor/action/:
    post:
      tags: [CWEBS]      
      summary:  suspend and reinstate drivers
      operationId: app.supervisor_action
      description: suspend and reinstate drivers
      parameters:
        - name: action_params
          in: body
          description: action params
          schema:
            $ref: "#/definitions/ActionSupervisorData"
      responses:
        200:
          description: success
        400:
          description: Error 

  /vehicle/action/:
    post:
      tags: [CWEBS]
      summary: Update, Add, Delete, Suspend, Reinstate a vehicle
      operationId: app.vehicle_action
      description: Update, Add a vehicle
      parameters:
        - name: action_params
          in: body
          description: vehicle params
          schema:
            $ref: "#/definitions/ActionVehicleData"
      responses:
        200:
          description: success
        400:
          description: Error 



  /vehicle/suspend_list/:
    get:
      tags: [CWEBS]
      operationId: app.vehicle_suspend_list
      summary: List of suspended vehicles      
      responses:
        200:
          description: Return version
          schema:
            type: string      

  /driver/suspend_list/:
    get:
      tags: [CWEBS]
      operationId: app.driver_suspend_list
      summary: List of suspended drivers
      
      responses:
        200:
          description: Return version
          schema:
            type: string      

definitions:
  Fare:
    required:
      - username
    properties:
      firstName:
        type: string
      lastName:
        type: string
      username:
        type: string
  Fares:
    type: array
    items:
      $ref: "#/definitions/Fare" 
  DriverMsg:
    required:
      - driver_id
      - operator_id
      - mesg
      - company_id
    properties:        
        driver_id:
          type: integer
          format: int32
          minimum: 1  
          default: 999
        operator_id: 
          type: integer       
          format: int32
          minimum: 1                 
          default: 999
        mesg:
          type: array
          items: 
            type: string
            minItems: 2
        company_id:
          type: integer
          format: int32
          minimum: 1         
          default: 999
        farenumber:
          type: string 
          pattern: "[0-9]{4,15}"
          minLength: 4
          maxLength: 15        
          default: "1234"
        driver_name:
          type: string
          minLength: 2
        operator_name:
          type: string
          minLength: 2
        zone:
          type: integer
          default: 17

  FareCreationRequiredDetails:   
    properties:
      pick_up_city:
        type: string
        minLength: 2
      fleet_number:
        type: integer
        format: int32
        minimum: 0
        maximum: 64
      pick_up_lat:
        type: number
        format: double
        minimum: -90.0
        maximum: 90.0
      pick_up_lng:
        type: number
        format: double
        minimum: -180.0
        maximum: 180.0

  FareCreation:
    required:
      - pick_up_city
      - fleet_number
      - pick_up_lat
      - pick_up_lng
    properties:
      pick_up_city:
        type: string
        minLength: 2
      fleet_number:
        type: integer
        format: int32
        minimum: 0
        maximum: 64
      pick_up_lat:
        type: number
        format: double
        minimum: -90.0
        maximum: 90.0
      pick_up_lng:
        type: number
        format: double
        minimum: -180.0
        maximum: 180.0
    allOf:
     - $ref: "#/definitions/FareDetails"             
 
  FareDetails:   
    properties:
      pick_up_city:
        type: string
        minLength: 2
      fleet_number:
        type: integer
        format: int32
        minimum: 0
        maximum: 64
      pick_up_lat:
        type: number
        format: double
        minimum: -90.0
        maximum: 90.0
      pick_up_lng:
        type: number
        format: double
        minimum: -180.0
        maximum: 180.0
      account_number: 
        type: string 
      bid_call:
        type: string
      bid_info:
        type: array
        items:
          type: string
      customer_number:
        type: string 
      callout_not_allowed:
        type: string
      contact_name:
        type: string 
      driver_preference:
        type: array
        items:
          type: integer
          format: int32
          maxItems: 16
      flat_rate:
        type: string
      dest_building_type:
        type: string
      dest_zone:
        type: integer
        format: int32
      destination_street_name: 
        type: string 
      destination_apartment_number: 
        type: string 
      destination_apartment_code: 
        type: string 
      destination_street_number: 
        type: string 
      destination_city:
        type: string 
      destination_building_name:
        type: string 
      destination_lat:
        type: number          
        format: double
        minimum: -90.0
        maximum: 90.0          
      destination_lng: 
        type: number
        format: double
        minimum: -180.0
        maximum: 180.0    
      driver_id:
          type: integer
          format: int32
          minimum: 1        
      estimated_mileage:
        type: integer
        format: int32
      exclude_ivr:
        type: string
      fare_type:
        type: string 
      force_zone:
        type: string
      is_corporate_account:
        type: boolean
      is_flat_rate:
        type: boolean
      local_call:
        type: string
      dispatch_priority:
        type: integer
        format: int32 
      mobile:
        type: string 

      number_of_jobs:
        type: integer
        format: int32

      no_service:
        type: string
 
      order_id:
        type: string
        pattern: "[0-9a-zA-Z]{1,11}"
        minLength: 1
        maxLength: 11

      operator_id: 
        type: integer       
        format: int32
        minimum: 1                 

      pickup_datetime:
        type: string

      pick_up_building_type:
        type: string

      priority_call:
        type: string

   
      orig_time:
        type: string


      payment_method:
        type: string

      passenger_name: 
        type: string 
        pattern: "[0-9a-zA-Z]{1,32}"

      pick_up_building_name:
        type: string 

      pick_up_apartment_number:
        type: string 

      pick_up_apartment_code:
        type: string 

      pick_up_street_number:
        type: string 

      pick_up_street_name:
        type: string 

      pick_up_zip_code:
        type: string 
      pick_up_passengers:
        type: integer
        format: int32          
    
      phone:
        type: string 

      prompts: 
        type: array
        items:
          type: string 

      quick_return:
        type: string

      remarks:
        type: array
        items:
          type: string
          minItems: 4
          maxItems: 4          

      restricted_code:
        type: string

      signature_required:
        type: string 

      tip_amount:
        type: string

      txt_back:
        type: string 
  
      vehicle_number:
        type: integer
        format: int32
        minimum: 1        

      vehicle_preference:
        type: array
        items:
          type: integer
          format: int32
          maxItems: 16

  FareCreatedData:
    required:
      - message
      - zone
      - job_number
      - fare_type
    properties:
      message:
        type: string
      zone:
        type: integer
      job_number:
        type: string
      fare_type:
        type: string

  FareCreated:
    required:
      - status
      - result
    properties:
      status:
        type: string
      result:       
          $ref: "#/definitions/FareCreatedData"          

  FareModifyCancel:
    required:
      - fare_number
    properties:    
      fare_number:
        type: string
        default: "1234"
      fare_type:
        type: string
        default: "immediate" 

  FareModification:
      allOf:       
          - $ref: "#/definitions/FareDetails"        
          - $ref: "#/definitions/FareModifyCancel"

  FareCancelation:
    required:
      - fare_number
    properties:
      fare_number:
        type: string
        default: "1234"
      fare_type:
        type: string
        default: "immediate"

  FareCanceledData:
    required:
      - message   
      - job_number
      - fare_type
    properties:
      message:
        type: string 
      job_number:
        type: string
      fare_type:
        type: string

  FareCanceled:
    required:
      - status
      - result
    properties:
      status:
        type: string
      result:       
          $ref: "#/definitions/FareCanceledData"          

  UpdateFare:
    required:
      - fare_number
      - action 
      - reason
      - operator_id
    properties:
      fare_number:
        type: string
        default:  "9243"
      action:
        type: string
        default: "accept no show"
      cancel_code:
        type: integer
        format: int32
        default: 12
      reason:
        type: string
        default: "entered by agent"
      operator_id:
        type: string
        default: 1001
      operator_name:
        type: string
        default: "supervisor"
      taxi:
        type: integer
        format: int32
        default: 8080
      fleet:
        type: integer
        format: int32
        default: 2

  VehicleMsg:
    required:
      - taxi
      - operator_id
      - mesg
      - company_id
    properties:        
        taxi:
          type: integer
          format: int32
          minimum: 1
        operator_id: 
          type: integer       
          format: int32
          minimum: 1          
        mesg:
          type: array
          items: 
            type: string
            minItems: 2
        company_id:
          type: integer
          format: int32
          minimum: 1          

        farenumber:
          type: string 
          pattern: "[0-9]{4,15}"
          minLength: 4
          maxLength: 15        
        driver_name:
          type: string
          minLength: 2
        operator_name:
          type: string
          minLength: 2
        zone:
          type: integer
          format: int32
          minimum: 0

  FleetMsg:
    required:
      - fleet
      - operator_id
      - mesg
      - company_id
    properties:        
        fleet:
          type: integer
          format: int32
          minimum: 0
          maximum: 2000
        operator_id: 
          type: integer       
          format: int32
          minimum: 1                 
        mesg:
          type: array
          items: 
            type: string
            minItems: 2
        company_id:
          type: integer
          format: int32
          minimum: 1          
        operator_name:
          type: string
          minLength: 2
        zone:
          type: integer
          format: int32
          minimum: 0
          maximum: 64

  ActionDriverData:
    required:
      - driver_id         
      - company_id         
      - action 
    properties:        
        driver_id:
          type: integer
          format: int32
          minimum: 1
          default: 8888
        company_id: 
          type: integer       
          format: int32
          minimum: 1                 
          default: 1
        action:       
          type: string
          default: "modify"
        db_action_id:
          type: integer
          format: int32
          minimum: 1
          default: 1          
        msg_id:
          type: integer       
          format: int32
          default: 1
    
  ActionVehicleData:
    required:
      - vehicle_id         
      - company_id         
      - action 
    properties:        
        vehicle_id:
          type: integer
          format: int32
          minimum: 1
          default: 8888
        company_id: 
          type: integer       
          format: int32
          minimum: 1  
          default: 1               
        action:       
          type: string
          default: "modify"
        msg_for_driver:
          type: string
        msg_for_dispatch:
          type: string          
        suspension_datetime_start:
          type: string
        suspension_datetime_end:
          type: string
        authority_id:
            type: integer          
            format: int32
            default: 1001
        db_action_id:
          type: integer
          format: int32
          minimum: 1          
          default: 1
        msg_id:
          type: integer       
          format: int32
          default: 1


  ActionFleetData:
    required:
      - fleet         
      - company_id         
      - action 
    properties:        
        fleet:
          type: integer
          format: int32
          minimum: 1
          default: 2
        company_id: 
          type: integer       
          format: int32
          minimum: 1                 
          default: 1
        action:       
          type: string
          default: "modify"
        name:
          type: string         
        operator_id:
          type: integer       
          format: int32
          default: 1001
        operator_name:
          type: string
          default: "supervisor 100"

  ActionSupervisorData:
    required:
      - driver_id         
      - company_id         
      - action 
    properties:        
        driver_id:
          type: integer
          format: int32
          minimum: 1
          default: 8888
        company_id: 
          type: integer       
          format: int32
          minimum: 1  
          default: 1               
        action:       
          type: string
          default: "modify"
        msg_for_driver:
          type: string
        msg_for_dispatch:
          type: string          
        suspension_datetime_start:
          type: string
        suspension_datetime_end:
          type: string
        authority_id:
            type: integer          
            format: int32            
            default: 1001
        taxi:
          type: integer
          format: int32
          minimum: 1          
          default: 1001
        fleet:
          type: integer
          format: int32
          minimum: 1
          default: 2
        db_action_id:
          type: integer
          format: int32
          minimum: 1          
          default: 1
        msg_id:
          type: integer       
          format: int32
          default: 1

  SuspensionVehicleEntry:
    properties:
      ## SuspensionData (object)
      vehicle_id: 
        type: integer
        format: int32
        default: 8080 
      suspension_datetime_start:
        type: string
      suspension_datetime_end:
        type: string
      authority_id: 
        type: integer
        default: 999      
      suspension_timestamp: 
        type: integer
        default: 147898875
      suspension_reasons:
        type: array
        items:  # [too fast, always late] array[string]
          type: string
          minItems: 2                    
      company_id: 
        type: integer       
        format: int32
        default: 1

  SuspensionDriverEntry:
    properties:
      ## SuspensionData (object)
      driver_id: 
        type: integer
        format: int32
        default: 8080 
      suspension_datetime_start:
        type: string
      suspension_datetime_end:
        type: string
      authority_id: 
        type: integer
        default: 999      
      suspension_timestamp: 
        type: integer
        default: 10 
      suspension_reasons:
        type: array
        items:  # [too fast, always late] array[string]
          type: string
          minItems: 2                    
      company_id: 
        type: integer       
        format: int32
        default: 1
 
  SuspensionVehicleListResponse:
    properties:
      status: 
        type : string
      result:  
        $ref: "#/definitions/SuspensionVehicleMessageContainer"

  SuspensionDriverListResponse:
    properties:
      status: 
        type : string
      result:                
        $ref: "#/definitions/SuspensionDriverMessageContainer"

  SuspensionDriverMessageContainer:
    properties:
      number_of_drivers:
        type: integer
      message:
        type: string
      drivers:
        type: array
        items: 
          $ref: "#/definitions/SuspensionDriverEntry"      

  SuspensionVehicleMessageContainer:
    properties:
      number_of_vehicles:
        type: integer
      message:
        type: string
      drivers:
        type: array
        items: 
            $ref: "#/definitions/SuspensionVehicleMessageContainer"      

securityDefinitions:
  oauth2:
    type: oauth2
    flow: implicit
    authorizationUrl: https://example.com/oauth2/dialog
    scopes:
      uid: Unique identifier of the user accessing the service.


